http://mbed.org/users/MatteoT/code/ESC/#b6d605c407b2
